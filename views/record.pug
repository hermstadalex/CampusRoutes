extends layout

block content
    //
        input(id="origin-input" class="controls" type="text"
            placeholder="Enter an origin location")

        input(id="destination-input" class="controls" type="text"
            placeholder="Enter a destination location")

        div(id="mode-selector" class="controls")
          input(type="radio" name="type" id="changemode-walking" checked="checked")
          label(for="changemode-walking") Walking

          input(type="radio" name="type" id="changemode-transit")
          label(for="changemode-transit") Transit

          input(type="radio" name="type" id="changemode-driving")
          label(for="changemode-driving") Driving
    
    div(class="center-block button-wrapper text-center")
        button(type="button" id="recordfinish" class="btn btn-danger") Stop Recording
    
    script(type='text/javascript').
        window.onload = function() {
            document.getElementById("recordfinish").onclick = function() {
                location.href= "/rate";
            };
        };

    div(id="map")

    script(type="text/javascript").
        var pathArray;
        var pathArray2;
        var pathArray3;
        var map;
        $(document).ready(function(){
        
            var datString = "#{data}".replace(/&quot;/g, '"');
            var comp = decodeURIComponent(datString);
            var data = JSON.parse(comp);
            
            pathArray = data.paths;
            
            var datString2 = "#{data2}".replace(/&quot;/g, '"');
            var comp2 = decodeURIComponent(datString2);
            var data2 = JSON.parse(comp2);
            
            pathArray2 = data2.paths;
            
            var datString3 = "#{data3}".replace(/&quot;/g, '"');
            var comp3 = decodeURIComponent(datString3);
            var data3 = JSON.parse(comp3);
            
            pathArray3 = data3.paths;
            
                            
            window.initMap = function initMap() {
              map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 32.879350, lng: -117.238559},
                zoom: 16
              });
              
              var path = new google.maps.Polyline({
                  path: pathArray,
                  geodesic: true,
                  strokeColor: '#00ff00',
                  strokeOpacity: 1.0,
                  strokeWeight: 2
              });

              path.setMap(map);
              path2.setMap(map);
              path3.setMap(map);
              
             // var infoWindow = new google.maps.InfoWindow({map: map});
               var image = 'places.png';

            

             var currLocMarker = new google.maps.Marker({
                    animation: google.maps.Animation.DROP,
                    icon: image,
                    scale: 0.01,
                    map: map,
                  });

              // Try HTML5 geolocation.
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                  var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                  };

                  currLocMarker.setPosition(pos);

                  //infoWindow.setPosition(pos);
                  //infoWindow.setContent('Current Location');
                  map.setCenter(pos);

                }, function() {
                  handleLocationError(true, infoWindow, map.getCenter());
                });
              } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
              }
            }

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
              infoWindow.setPosition(pos);
              infoWindow.setContent(browserHasGeolocation ?
                                    'Error: The Geolocation service failed.' :
                                    'Error: Your browser doesn\'t support geolocation.');
            }
        })

    script(async defer src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyC4Mdmwz4M0GbhDNj1PwjTnQ7FTx-wOLic&callback=initMap").
